<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<style> canvas {position:fixed; width: 100%; height: 100%;} </style>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		let pause= false;
		let started=false;
		let WIDTH=canvas.width;
		let HEIGHT=canvas.height;
		let rightScore=0;
		let leftScore=0;
		
		app.onInit = function(){
			this.canvas=document.getElementById("canvas");

			let ballXCoord=this.getNode("ball").x
			let ballYCoord=this.getNode("ball").y
			let ballXSpeed=this.getNode("ball").xDirSpeed
			let ballYSpeed=this.getNode("ball").yDirSpeed
			let ballWidth=this.getNode("ball").width
			let leftXCoord=this.getNode("left-player").x
			let leftYCoord=this.getNode("left-player").y
			let rightXCoord=this.getNode("right-player").x
			let rightYCoord=this.getNode("right-player").y
			let playerWidth=this.getNode("left-player").width
			let playerHeight=this.getNode("left-player").height

			
			this.nodes.push({
				id:"left-player",
				x: (this.canvas.width / 32),
				y: (this.canvas.height / 2) - 35,
				width: canvas.width * 0.01,
				height: canvas.height * 0.2,
				color: "green",
			});

			this.nodes.push({
				id: "right-player",
				x: this.canvas.width - (this.canvas.width / 22),
				y: (this.canvas.height / 2) - 35,
				width: canvas.width * 0.01,
				height: canvas.height * 0.2,
				color: "green",
			});
			this.nodes.push({
				id: "ball",
				x: canvas.width / 2,
				y: canvas.height / 2,
				radius: this.getNode("left-player").width/2,
				width: this.getNode("left-player").width,
				height: this.getNode("left-player").width,
				color: "green",
				xDirSpeed: (4*posOrNeg()),
				yDirSpeed: (4*posOrNeg()),

			});


		document.addEventListener("keydown", (e) => {
				
				if(e.keyCode==82){
					app.restart();
				
				}
				if(e.keyCode==87 && pause==false){
					this.getNode("left-player").y -= 41;
				
				}if(e.keyCode==83 && pause==false){
					this.getNode("left-player").y += 41;

				}if(e.keyCode==38 && pause==false){
					this.getNode("right-player").y -= 41;

				}if(e.keyCode==40 && pause==false){
					this.getNode("right-player").y += 41;

				}if(e.keyCode==32){
					app.pause();
				
				}
				
        });

		app.pause= function(){
			console.log("Gab");
			if(pause==false){
				pause=true;
			}else if(pause==true){
				pause=false;
			}

		};

		app.restart=function(){
				this.getNode("ball").x = canvas.width/2
				this.getNode("ball").y = canvas.height/2
		};


		function posOrNeg(){
			var ent = (Math.floor(Math.random() * 2)+1)
			if (ent == 2){
				ent = -1
			}
			if (ent == 1){
				ent = 1
			}
			return(ent)
		};

		app.drawLScore= function(){
			this.context.fillStyle= "green";
			this.context.font = "45px Arial";
			this.context.fillText(leftScore,WIDTH/2-WIDTH/17, HEIGHT/7 );
		};

		app.drawRScore= function(){
			this.context.fillStyle= "green";
			this.context.font = "45px Arial";
			this.context.fillText(rightScore,WIDTH/2+WIDTH/25,HEIGHT/7 );
		};



		app.bumper= function() {
			this.getNode('ball').x+=this.getNode('ball').xDirSpeed;

			this.getNode('ball').y+=this.getNode('ball').yDirSpeed;

			if (this.getNode("ball").y <0) { 
			this.getNode("ball").yDirSpeed *= -1;
			} 
			if ((this.getNode("ball").y > HEIGHT- this.getNode("ball").height)) { 
			this.getNode("ball").yDirSpeed *= -1;
			}
			//Paddle Bounds
			if(this.getNode("left-player").y <= 0){
				this.getNode("left-player").y = 0;
			}else if(this.getNode("left-player").y >= HEIGHT - this.getNode("left-player").height){
				this.getNode("left-player").y = HEIGHT - this.getNode("left-player").height
			}
			if(this.getNode("right-player").y <= 0){
				this.getNode("right-player").y = 0;
			}else if(this.getNode("right-player").y>= HEIGHT - this.getNode("right-player").height){
				this.getNode("right-player").y = HEIGHT - this.getNode("right-player").height
			}
			
			//Paddle Collissions
			//Left player Paddle
			if ( this.getNode("ball").x - this.getNode("ball").width <= this.getNode("left-player").x 
			&& this.getNode("ball").y - (this.getNode("ball").height/2)<= this.getNode("left-player").y + (this.getNode("left-player").height)
			&& this.getNode("ball").y + (this.getNode("ball").height/2)>= this.getNode("left-player").y ) { 
			//console.log("hit");
			this.getNode("ball").xDirSpeed *= -1;
			} 
			//Right player Paddle
			if ( this.getNode("ball").x + this.getNode("ball").width >= this.getNode("right-player").x 
			&& this.getNode("ball").y - (this.getNode("ball").height/2)<= this.getNode("right-player").y + (this.getNode("right-player").height)
			&& this.getNode("ball").y + (this.getNode("ball").height/2)>= this.getNode("right-player").y) { 
			//console.log("hit");
			this.getNode("ball").xDirSpeed *= -1;
			} 
			//Scoring conditions
			if (this.getNode("ball").x < 0) {
			rightScore++
            console.log("Right Player Score: "+rightScore);
			app.restart();
        	} else if (this.getNode("ball").x + this.getNode("ball").width > WIDTH) {
			leftScore++
            console.log('Left Player Score:'+leftScore);
			app.restart();
        	}
			
		};
		
 
		app.onUpdate = function(time){

		if(pause==false){
			this.bumper()
		}
		this.drawLScore();
		this.drawRScore();

		};

	};
	</script>
</body>
</html>