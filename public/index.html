<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
	<style> canvas {position:fixed; width: 100%; height: 100%;} </style>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.


		let leftPlayerDown=false;
		let leftPlayerUp=false;
		let rightPlayerDown=false;
		let rightPlayerUp=false;
		let paused= false;
		let started=false;
		let WIDTH=canvas.width;
		let HEIGHT=canvas.height;
		


		app.onInit = function(){
			this.canvas=document.getElementById("canvas");

			let ballXCoord=this.getNode("ball").x
			let ballYCoord=this.getNode("ball").y
			let ballXSpeed=this.getNode("ball").xDirSpeed
			let ballYSpeed=this.getNode("ball").yDirSpeed
			let ballWidth=this.getNode("ball").width
			let leftXCoord=this.getNode("left-player").x
			let leftYCoord=this.getNode("left-player").y
			let rightXCoord=this.getNode("right-player").x
			let rightYCoord=this.getNode("right-player").y
			let playerWidth=this.getNode("left-player").width
			let playerHeight=this.getNode("left-player").height

			
			this.nodes.push({
				id:"left-player",
				x: (this.canvas.width / 32),
				y: (this.canvas.height / 2) - 35,
				width: canvas.width * 0.01,
				height: canvas.height * 0.2,
				color: "green",
			});

			this.nodes.push({
				id : 'red-box',
				x  : 100,
				y  : 0,
				width  : 100,
				height : 100,
				color  : 'red',
				direction : 0
			});

			this.nodes.push({
				id: "right-player",
				x: this.canvas.width - (this.canvas.width / 22),
				y: (this.canvas.height / 2) - 35,
				width: canvas.width * 0.01,
				height: canvas.height * 0.2,
				color: "green",
			});
			this.nodes.push({
				id: "ball",
				x: canvas.width / 2,
				y: canvas.height / 2,
				radius: this.getNode("left-player").width/2,
				width: this.getNode("left-player").width,
				height: this.getNode("left-player").width,
				color: "green",
				xDirSpeed: (4*posOrNeg()),
				yDirSpeed: (4*posOrNeg()),
				// xDirSpeed: Math.random()<0.5?(Math.floor(Math.random()* 3)+1) : -(Math.floor(Math.random()*3)+1),
				// yDirSpeed: Math.random()<0.5?(Math.floor(Math.random()* 3)+1) : -(Math.floor(Math.random()*3)+1),
				// xDirSpeed: 1,
				// yDirSpeed: 1,

				

			});

			function ballMove(){
				ballXCoord = ballXCoord+ ballXSpeed;
			}


			function restart(){
				ball.x = canvas.width
			}


		document.addEventListener("keydown", (e) => {
				if(e.keyCode==32){
					app.pause();
				
				}
				if(e.keyCode==82){
					app.restart();
				
				}
				if(e.keyCode==87){
					this.getNode("left-player").y -= 17;
				
				}if(e.keyCode==83){
					this.getNode("left-player").y += 17;

				}if(e.keyCode==38){
					this.getNode("right-player").y -= 17;

				}if(e.keyCode==40){
					this.getNode("right-player").y += 17;

				}
        });

        document.addEventListener("keyup", (e) => {
			leftPlayerUp=false;
			leftPlayerDown=false;
			rightPlayerUp=false;
			rightPlayerDown=false;
        });

		function posOrNeg(){
			var ent = (Math.floor(Math.random() * 2)+1)
			if (ent == 2)
				ent = -1
			if (ent == 1)
				ent = 1
			return(ent)
		}

		app.bumper= function() {
			this.getNode('ball').x+=this.getNode('ball').xDirSpeed;

			this.getNode('ball').y+=this.getNode('ball').yDirSpeed;

			if (this.getNode("ball").y <0) { 
			this.getNode("ball").yDirSpeed *= -1;
			} 
			if ((this.getNode("ball").y > HEIGHT- this.getNode("ball").height)) { 
			this.getNode("ball").yDirSpeed *= -1;
			}
			if ( this.getNode("ball").x - this.getNode("ball").width <= this.getNode("left-player").x 
			&& this.getNode("ball").y - (this.getNode("ball").height/2)<= this.getNode("left-player").y + (this.getNode("left-player").height)
			&& this.getNode("ball").y + (this.getNode("ball").height/2)>= this.getNode("left-player").y ) { 
			//console.log("hit");
			this.getNode("ball").xDirSpeed *= -1;
			} 
			
			if ( this.getNode("ball").x + this.getNode("ball").width >= this.getNode("right-player").x 
			&& this.getNode("ball").y - (this.getNode("ball").height/2)<= this.getNode("right-player").y + (this.getNode("right-player").height)
			&& this.getNode("ball").y + (this.getNode("ball").height/2)>= this.getNode("right-player").y) { 
			//console.log("hit");
			this.getNode("ball").xDirSpeed *= -1;
			} 
			
		}

		

		app.updateBall= function(){
		//this.getNode("ball").x += this.getNode("ball").xDirSpeed;
		//this.getNode("ball").y += this.getNode("ball").yDirSpeed;
		this.getNode('ball').y++
		// this.getNode('ball').x--


		//Ball Boundaries
		if (this.getNode("ball").y <0) { 
			this.getNode("ball").yDirSpeed *= -1;
		} 
		if ((this.getNode("ball").y > HEIGHT- this.getNode("ball").height)) { 
			this.getNode("ball").yDirSpeed *= -1;
		}
		//Scoring Conditions
		if (this.getNode("ball").x  - this.getNode("ball").width < 0 || this.getNode("ball").x + this.getNode("ball").width > WIDTH) { //point is scored by either computer or player
        if (this.getNode("ball").x < 0) {
            console.log('Right Player wins !');
        } else if (this.getNode("ball").x + this.getNode("ball").width > WIDTH) {
            console.log('Left Player wins !');
        }
        this.xSpeed = 0;
        this.ySpeed = 3;
        this.x = WIDTH / 2;
        this.y = HEIGHT / 2;
		//Player Collissions
		if (this.x >  HEIGHT/ 2) {
        if ((this.getNode("ball").y + this.getNode("ball").width) > this.getNode("left-player").y  && (this.getNode("ball").y - this.getNode("ball").width) < this.getNode("left-player").y && (this.x - this.radius) < (player_paddle.x + player_paddle.width) && (this.x + this.radius) > player_paddle.x) {
            this.ySpeed = -this.ySpeed;
            this.xSpeed += (player_paddle.xSpeed / 2);
            this.y += this.ySpeed;
        }
    } else {
        if ((this.y - this.radius) < (computer_paddle.y + computer_paddle.height) && (this.y + this.radius) > computer_paddle.y && (this.x - this.radius) < (computer_paddle.x + computer_paddle.width) && (this.x + this.radius) > computer_paddle.x) {
            this.ySpeed = -this.ySpeed;
            this.x += (computer_paddle.xSpeed / 2);
            this.y += this.ySpeed;
        }
    }
    }
		
		
		};
		

		app.onUpdate = function(time){
			
			//this.getNode('ball').y--
			//this.getNode('ball').x--
			this.bumper();

			// this.getNode('ball').x+=this.getNode('ball').xDirSpeed;

			// this.getNode('ball').y+=this.getNode('ball').yDirSpeed;

		};

	};
	</script>
</body>
</html>